<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–ê–≤—Ç–æ—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ç–æ—Ä –ø–æ—á—Ç</title>
    <style>
        body { font-family: Arial; padding: 20px; }
        .log { background: black; color: lime; padding: 10px; height: 200px; overflow-y: scroll; }
        .error { color: red; }
    </style>
</head>
<body>
    <h1>üìß –ê–≤—Ç–æ—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ç–æ—Ä Yahoo/Proton</h1>
    
    <label>–°–µ—Ä–≤–∏—Å:</label>
    <select id="service">
        <option value="yahoo">Yahoo</option>
        <option value="proton">Proton</option>
    </select><br><br>

    <label>–õ–æ–≥–∏–Ω (–±–µ–∑ @):</label>
    <input id="login" placeholder="myemail123"><br><br>

    <label>–ü–∞—Ä–æ–ª—å:</label>
    <input id="password" type="password" placeholder="–ø–∞—Ä–æ–ª—å"><br><br>

    <button onclick="register()">‚úÖ –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å</button>
    <button onclick="checkMails()">üì¨ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ—á—Ç—É</button>

    <h3>–õ–æ–≥–∏:</h3>
    <div class="log" id="log"></div>

    <h3>–°–æ–∑–¥–∞–Ω–Ω—ã–µ –∞–∫–∫–∞—É–Ω—Ç—ã:</h3>
    <div id="accounts"></div>

    <script>
        const API = 'http://localhost:3000';

        async function register() {
            const service = document.getElementById('service').value;
            const login = document.getElementById('login').value;
            const password = document.getElementById('password').value;

            log(`–ù–∞—á–∏–Ω–∞—é —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é ${service}...`);

            const response = await fetch(`${API}/register`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ service, login, password })
            });

            const result = await response.json();
            
            if (result.success) {
                log(`‚úÖ –£—Å–ø–µ—à–Ω–æ: ${result.email}`);
                loadAccounts();
            } else {
                log(`‚ùå –û—à–∏–±–∫–∞: ${result.error}`, 'error');
                if (result.captcha) {
                    log('‚ö†Ô∏è –û–±–Ω–∞—Ä—É–∂–µ–Ω–∞ –∫–∞–ø—á–∞! –ó–∞–≤–µ—Ä—à–∞—é —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.', 'error');
                }
            }
        }

        async function checkMails() {
            log('–ü—Ä–æ–≤–µ—Ä—è—é –ø–æ—á—Ç—É...');
            const response = await fetch(`${API}/check-mail`);
            const data = await response.json();
            data.forEach(msg => {
                log(`üì© ${msg.from}: ${msg.subject}`);
            });
        }

        async function loadAccounts() {
            const res = await fetch(`${API}/accounts`);
            const accounts = await res.json();
            document.getElementById('accounts').innerHTML = 
                accounts.map(a => `<div>${a.email} (${a.service})</div>`).join('');
        }

        function log(text, type = 'info') {
            const div = document.getElementById('log');
            const entry = document.createElement('div');
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${text}`;
            entry.className = type;
            div.appendChild(entry);
            div.scrollTop = div.scrollHeight;
        }

        loadAccounts();
    </script>
</body>
</html>
