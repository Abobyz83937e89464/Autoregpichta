<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>üìß Auto Mail Bot</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <h1>ü§ñ Auto Mail Bot</h1>
        <p>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è Yahoo/Proton + –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥</p>
        
        <div class="card">
            <h2>üîê –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h2>
            <select id="service">
                <option value="yahoo">Yahoo</option>
                <option value="proton">ProtonMail</option>
            </select>
            <input type="text" id="login" placeholder="–õ–æ–≥–∏–Ω (–±–µ–∑ @)">
            <input type="password" id="password" placeholder="–ü–∞—Ä–æ–ª—å">
            <button onclick="register()">üöÄ –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å</button>
        </div>
        
        <div class="card">
            <h2>üì¨ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥</h2>
            <button onclick="checkMail()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ—á—Ç—É</button>
            <div id="emails"></div>
        </div>
        
        <div class="card">
            <h2>üìä –ê–∫–∫–∞—É–Ω—Ç—ã (<span id="count">0</span>)</h2>
            <div id="accounts"></div>
        </div>
        
        <div class="logs">
            <h3>üìù –õ–æ–≥–∏</h3>
            <div id="log"></div>
        </div>
    </div>
    
    <script>
        const API = 'http://localhost:3000';
        
        async function register() {
            const service = document.getElementById('service').value;
            const login = document.getElementById('login').value;
            const password = document.getElementById('password').value;
            
            log(`–ù–∞—á–∏–Ω–∞—é —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é –≤ ${service}...`);
            
            const res = await fetch(`${API}/register`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({service, login, password})
            });
            
            const data = await res.json();
            
            if (data.success) {
                log(`‚úÖ ${data.email} —Å–æ–∑–¥–∞–Ω`);
                loadAccounts();
            } else {
                log(`‚ùå –û—à–∏–±–∫–∞: ${data.error}`, 'error');
                if (data.captcha) {
                    log('‚ö†Ô∏è –ö–∞–ø—á–∞! –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ –∏–ª–∏ –≤—Ä—É—á–Ω—É—é.', 'error');
                }
            }
        }
        
        async function checkMail() {
            const res = await fetch(`${API}/check-mail`);
            const emails = await res.json();
            document.getElementById('emails').innerHTML = 
                emails.map(e => `<div>üì© ${e.from}: ${e.subject}</div>`).join('');
        }
        
        async function loadAccounts() {
            const res = await fetch(`${API}/accounts`);
            const accounts = await res.json();
            document.getElementById('accounts').innerHTML = 
                accounts.map(a => `
                    <div class="account">
                        <strong>${a.email}</strong> (${a.service})
                        <small>${a.created}</small>
                    </div>
                `).join('');
            document.getElementById('count').textContent = accounts.length;
        }
        
        function log(msg, type = 'info') {
            const div = document.getElementById('log');
            const entry = document.createElement('div');
            entry.className = `log-entry ${type}`;
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${msg}`;
            div.appendChild(entry);
            div.scrollTop = div.scrollHeight;
        }
        
        // –ó–∞–≥—Ä—É–∂–∞–µ–º –∞–∫–∫–∞—É–Ω—Ç—ã –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
        loadAccounts();
    </script>
</body>
</html>
